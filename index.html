<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor 3MF</title>
    
    <!-- Bibliotecas necesarias -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/libs/fflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/3MFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>

    <style>
        body { margin: 0; background-color: #222; color: white; text-align: center; }
        canvas { display: block; }
        #container { width: 100vw; height: 80vh; }
    </style>
</head>
<body>

    <h2>Mod 3D - JESD </h2>
    <div id="container"></div>

    <script>
        let scene, camera, renderer, controls;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / (window.innerHeight * 0.8), 0.1, 1000);
            camera.position.set(0, 1, 5); // Posición inicial de la cámara

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight * 0.8);
            document.getElementById("container").appendChild(renderer.domElement);

            // Controles de usuario para mover el modelo
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 1;
            controls.maxDistance = 20;

            // Iluminación mejorada
            const light1 = new THREE.DirectionalLight(0xffffff, 1);
            light1.position.set(5, 5, 5);
            scene.add(light1);

            const light2 = new THREE.AmbientLight(0x404040, 2);
            scene.add(light2);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        function load3MF(url) {
            const loader = new THREE.ThreeMFLoader();
            loader.load(url, function (object) {
                // Ajustar el modelo
                object.scale.set(0.1, 0.1, 0.1); // Escalar para mejor visualización
                object.position.set(0, 0, 0); // Centrar el modelo
                
                // Calcular los límites del modelo
                const box = new THREE.Box3().setFromObject(object);
                const center = new THREE.Vector3();
                box.getCenter(center);
                object.position.sub(center); // Centrar el modelo

                scene.add(object);
                console.log("Modelo cargado y centrado:", object);
            }, undefined, function (error) {
                console.error("Error al cargar el modelo 3MF:", error);
            });
        }

        window.addEventListener("resize", () => {
            camera.aspect = window.innerWidth / (window.innerHeight * 0.8);
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight * 0.8);
        });

        init();
        load3MF("CE3E3V2_minecraft_bee_textured_with_stinger.3mf"); // Cargar el archivo 3MF

    </script>

</body>
</html>
